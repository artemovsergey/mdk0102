# Лекция 9. Настройка окружения для тестирования и разработки на .NET

**Цель:** Сформировать понимание основ экосистемы .NET, научиться настраивать рабочее окружение с нуля и управлять зависимостями проектов.

---

### **План лекции**

1.  **Введение в экосистему .NET: почему это важно для тестировщика?**
2.  **Установка и настройка .NET SDK: фундамент нашего окружения.**
3.  **Знакомство с Visual Studio: наша основная среда разработки и тестирования.**
4.  **Управление пакетами с помощью NuGet: работа с зависимостями.**
5.  **Создание и запуск первого тестового проекта (на примере NUnit/xUnit).**

---

### **Подробное рассмотрение каждого пункта плана**

#### **1. Введение в экосистему .NET: почему это важно для тестировщика?**

**Подробное объяснение:**

Любое программное обеспечение, включая приложения, которые вам предстоит тестировать, работает в определенном окружении. Для .NET это окружение состоит из нескольких ключевых компонентов.

*   **.NET Runtime (Среда выполнения):** Это "виртуальная машина", которая выполняет скомпилированный код. Без нее приложение не запустится. Представьте, что это двигатель автомобиля.
*   **.NET SDK (Software Development Kit):** Набор инструментов для разработки. Он включает компиляторы, библиотеки, шаблоны проектов и, что важно, *инструменты для выполнения тестов*. SDK — это целая мастерская с инструментами для постройки автомобиля.
*   **Visual Studio / VS Code:** Интегрированная среда разработки (IDE). Это ваш рабочий стол, где вы пишете код, запускаете тесты, отлаживаете ошибки и управляете проектами.

**Почему это важно для тестировщика, особенно для автоматизатора?**

1.  **Понимание дефектов:** Ошибка "Could not load file or assembly" часто связана с проблемами окружения. Зная компоненты, вы сможете точнее описать дефект.
2.  **Запуск автотестов:** Большинство фреймворков для автоматизированного тестирования (Selenium WebDriver, NUnit, xUnit) требуют наличия .NET SDK для компиляции и запуска.
3.  **Независимость:** Вы можете самостоятельно настроить стенд для тестирования, не полагаясь на разработчиков.
4.  **Чтение логов:** Логи сборки и выполнения часто содержат информацию о версиях .NET, отсутствующих пакетах NuGet. Без понимания этих сущностей анализ логов затруднен.

**Пример:** Если автотест падает с ошибкой `The test host for executable *.dll failed to exit`, первое, что проверяет опытный тестировщик — соответствие версий .NET SDK на машине и в конфигурации тестового проекта.

---

#### **2. Установка и настройка .NET SDK: фундамент нашего окружения**

**Подробное объяснение:**

.NET SDK — это командная строка, которая позволяет нам делать все: создавать проекты, компилировать код, запускать приложения и тесты, управлять пакетами.

**Шаги по установке:**

1.  **Переход на официальный сайт:** [https://dotnet.microsoft.com/download](https://dotnet.microsoft.com/download)
2.  **Выбор версии:** Рекомендуется выбирать **LTS (Long-Term Support)** версию, так как она наиболее стабильна и поддерживается долгое время. Для начала обучения это идеальный вариант.
3.  **Выбор типа установщика:** Для Windows скачиваем и запускаем `.exe` установщик. Установка стандартная: "Далее-Далее-Готово".

**Проверка установки:**

После установки необходимо проверить, что система "видит" команды .NET.

1.  Откройте **Командную строку (CMD)** или **PowerShell**.
2.  Введите команду и нажмите Enter:
    ```bash
    dotnet --version
    ```
3.  В ответ вы должны увидеть номер установленной версии, например, `8.0.201`.

![Пример выполнения команды dotnet --version](https://miro.medium.com/v2/resize:fit:1400/1*_6Z8yWtUYHMY1NwVhwkdCw.png)
*Пример успешной проверки версии .NET SDK.*

**Важные команды CLI (Command Line Interface), которые нужно знать:**

*   `dotnet new` - создает новый проект.
*   `dotnet build` - компилирует проект.
*   `dotnet run` - компилирует и сразу запускает проект.
*   `dotnet test` - запускает тесты в проекте. *(Ключевая команда для тестировщика!)*

**Пример для тестировщика:** Вам нужно запустить набор автотестов на сервере непрерывной интеграции (CI), где нет графического интерфейса. Вы будете использовать команду `dotnet test MyTestProject.csproj`.

---

#### **3. Знакомство с Visual Studio: наша основная среда разработки и тестирования**

**Подробное объяснение:**

Visual Studio (VS) — это мощная IDE, которая значительно ускоряет работу. Для тестировщика важны не все ее функции, а конкретные инструменты.

**Шаги по установке:**

1.  Скачайте **Community**-версию с официального сайта Microsoft. Она бесплатна и полнофункциональна для обучения и небольших проектов.
2.  В установщике обязательно выберите рабочую нагрузку **"Разработка кроссплатформенных приложений .NET"**. Это гарантирует, что будут установлены все необходимые компоненты для работы с современным .NET.

**Ключевые элементы интерфейса для тестировщика:**

*   **Обозреватель решений (Solution Explorer):** Здесь отображается структура вашего проекта. Вы видите все файлы, зависимости и ссылки.
*   **Редактор кода:** Основное пространство для написания кода и тестов.
*   **Обозреватель тестов (Test Explorer):** **Ваш главный инструмент!** Он автоматически находит все тесты в решении и предоставляет удобный интерфейс для их запуска, отладки и анализа результатов.
*   **Диспетчер пакетов NuGet (NuGet Package Manager):** Окно для управления зависимостями.

**Практический пример: Открытие тестового проекта.**

1.  Представьте, что разработчик передал вам проект с автотестами.
2.  Вы открываете файл решения (`.sln`) в Visual Studio.
3.  Открываете окно **Test Explorer** (Вид -> Обозреватель тестов).
4.  Visual Studio автоматически соберет проект и обнаружит все тесты. Вы можете запустить их все, только упавшие или конкретную группу.

![Test Explorer в Visual Studio](https://learn.microsoft.com/ru-ru/visualstudio/test/media/test-explorer-16-2.png?view=vs-2022)
*Окно Test Explorer с успешно пройденными и упавшими тестами.*

---

#### **4. Управление пакетами с помощью NuGet: работа с зависимостями**

**Подробное объяснение:**

Ни один современный проект не пишется с нуля. Мы используем сторонние библиотеки. Для .NET основным менеджером пакетов является **NuGet**.

*   **Пакет (Package):** Это архив с собранной библиотекой (DLL), другой информацией и зависимостями.
*   **Реpository (Источник пакетов):** Официальный репозиторий — [nuget.org](https://www.nuget.org/). Компании могут иметь свои приватные репозитории.

**Как добавить пакет в проект? (3 способа)**

**Способ 1: Диспетчер пакетов NuGet в Visual Studio (Самый простой).**

1.  Щелкните правой кнопкой мыши по проекту в **Обозревателе решений**.
2.  Выберите **"Управление пакетами NuGet..."**.
3.  В открывшемся окне найдите нужный пакет, выберите версию и нажмите "Установить".

*   **Пример для тестировщика:** Вам нужно добавить в проект фреймворк для тестирования `NUnit`.
    *   Ищете "NUnit".
    *   Выбираете последнюю стабильную версию (например, `3.14.0`).
    *   Устанавливаете. Visual Studio автоматически добавит все необходимые ссылки в проект.

**Способ 2: Консоль диспетчера пакетов (Package Manager Console).**

Это окно в Visual Studio, где можно выполнять команды PowerShell для управления пакетами.

*   Команда для установки: `Install-Package NUnit -Version 3.14.0`
*   **Преимущество:** Можно легко установить одну и ту же версию пакета в несколько проектов сразу.

**Способ 3: CLI .NET (Командная строка).**

Самый универсальный способ, работает вне зависимости от IDE.

```bash
# Перейдите в папку с файлом проекта (.csproj)
dotnet add package NUnit --version 3.14.0
```

**Куда это все записывается? Файл `*.csproj`.**
После добавления пакета в файл вашего проекта автоматически добавляется запись:

```xml
<ItemGroup>
  <PackageReference Include="NUnit" Version="3.14.0" />
</ItemGroup>
```

Этот файл теперь является конфигурацией ваших зависимостей. Добавив его в систему контроля версий (Git), любой другой участник команды (или сервер CI) сможет восстановить эти пакеты командой `dotnet restore`.

---

#### **5. Создание и запуск первого тестового проекта (на примере NUnit/xUnit)**

**Практическое закрепление.** Давайте создадим простой тестовый проект с нуля.

**Шаг 1: Создание проекта.**

1.  В Visual Studio: Файл -> Создать -> Проект.
2.  В поиске введите "NUnit" или "xUnit" и выберите соответствующий шаблон тестового проекта (например, `NUnit Test Project`).
3.  Или через CLI:
    ```bash
    dotnet new nunit -n MyFirstTestProject
    cd MyFirstTestProject
    ```

**Шаг 2: Анализ созданного проекта.**

Откройте созданный файл `UnitTest1.cs`. Изучите его структуру:

```csharp
using NUnit.Framework; // Импорт пространства имен NUnit

namespace MyFirstTestProject
{
    public class Tests
    {
        [SetUp] // Атрибут, помечающий метод, который выполняется ПЕРЕД КАЖДЫМ тестом.
        public void Setup()
        {
            // Здесь обычно инициализируются объекты, которые используются в тестах.
            // Например, запуск браузера для UI-тестов.
        }

        [Test] // Атрибут, который помечает метод как ТЕСТОВЫЙ.
        public void Test1()
        {
            // Arrange (Подготовка): Подготовьте данные и окружение.
            int a = 5;
            int b = 10;

            // Act (Действие): Выполните действие, которое тестируете.
            int result = a + b;

            // Assert (Проверка): Проверьте, что результат соответствует ожиданиям.
            Assert.AreEqual(15, result); // Класс Assert — наш главный инструмент валидации.
        }
    }
}
```

**Шаг 3: Запуск теста.**

1.  Откройте **Test Explorer**.
2.  Вы должны увидеть тест с именем `Test1`.
3.  Нажмите кнопку "Запустить все". Напротив теста должна загореться зеленая галочка.
4.  Или через CLI:
    ```bash
    dotnet test
    ```

Поздравляю, вы только что создали, настроили и запустили свое первое автоматизированное тестовое окружение на .NET!

---

### **Резюме**

1.  **.NET SDK** — это фундамент, набор инструментов для сборки и запуска приложений и тестов.
2.  **Visual Studio** — мощная среда, которая упрощает разработку и тестирование, особенно благодаря **Test Explorer**.
3.  **NuGet** — система управления зависимостями. Все внешние библиотеки (включая фреймворки для тестирования) подключаются через него.
4.  Понимание этой цепочки (`Среда -> IDE -> Зависимости -> Проект`) является критически важным навыком для любого профессионального тестировщика автоматизированного тестирования на .NET.

---

### **Контрольные вопросы**

1.  Объясните разницу между .NET Runtime и .NET SDK. Для чего нужен каждый из этих компонентов?
2.  Какую команду нужно выполнить в командной строке, чтобы проверить, установлен ли .NET SDK и его версию?
3.  Какое окно в Visual Studio является основным для работы с автоматизированными тестами? Опишите его возможности.
4.  Какими тремя способами можно добавить пакет NuGet (например, Selenium.WebDriver) в свой проект?
5.  Что произойдет, если вы отправите в репозиторий Git файл с кодом, но не отправите файлы установленных пакетов NuGet? Сможет ли другой участник команды собрать проект? Почему?
6.  Опишите структуру типичного unit-теста: какие три этапа (AAA) он обычно включает и какие атрибуты NUnit для этого используются?
7.  Какую команду .NET CLI нужно использовать для запуска всех тестов в проекте?