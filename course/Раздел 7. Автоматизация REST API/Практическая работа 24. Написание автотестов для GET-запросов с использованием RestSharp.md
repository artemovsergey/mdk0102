# Практическая работа 24. Написание автотестов для GET-запросов с использованием RestSharp

Разработка автоматизированных тестов для GET-запросов с использованием библиотеки RestSharp в .NET

## Цель
Освоить практические навыки создания автоматизированных тестов для REST API GET-запросов с использованием библиотеки RestSharp в среде .NET.

## Задачи
- Изучить основы работы с библиотекой RestSharp
- Научиться настраивать клиент для работы с API
- Освоить создание и выполнение GET-запросов
- Научиться валидировать статус коды и тела ответов
- Освоить работу с различными типами данных (JSON, XML)
- Научиться писать параметризованные тесты

## Теоретическая часть

### 1. Библиотека RestSharp
RestSharp - это популярная .NET библиотека для работы с REST API. Основные компоненты:

- **RestClient** - основной клиент для выполнения запросов
- **RestRequest** - представляет HTTP запрос
- **RestResponse** - содержит ответ от сервера
- **JsonSerializer** - для работы с JSON данными

### 2. Установка и настройка
```xml
<PackageReference Include="RestSharp" Version="110.2.0" />
<PackageReference Include="NUnit" Version="3.14.0" />
<PackageReference Include="NUnit3TestAdapter" Version="4.5.0" />
<PackageReference Include="Microsoft.NET.Test.Sdk" Version="17.8.0" />
```

### 3. Базовая структура теста
```csharp
[Test]
public void GetUser_ValidId_ReturnsUser()
{
    // Arrange
    var client = new RestClient("https://api.example.com");
    var request = new RestRequest("users/1", Method.Get);
    
    // Act
    var response = client.Execute(request);
    
    // Assert
    Assert.That(response.StatusCode, Is.EqualTo(HttpStatusCode.OK));
}
```

## Практический пример выполнения

### Проектная структура
```
RestSharpGetTests/
│
├── Models/
│   ├── User.cs
│   ├── Post.cs
│   └── Todo.cs
│
├── Tests/
│   ├── BasicGetTests.cs
│   ├── DataDrivenGetTests.cs
│   └── AdvancedGetTests.cs
│
├── Helpers/
│   └── ApiClient.cs
│
├── packages/
└── RestSharpGetTests.csproj
```

### Пример 1: Базовый GET-запрос

#### Модель данных
```csharp
// Models/User.cs
using System.Text.Json.Serialization;

public class User
{
    [JsonPropertyName("id")]
    public int Id { get; set; }
    
    [JsonPropertyName("name")]
    public string Name { get; set; }
    
    [JsonPropertyName("username")]
    public string Username { get; set; }
    
    [JsonPropertyName("email")]
    public string Email { get; set; }
    
    [JsonPropertyName("phone")]
    public string Phone { get; set; }
    
    [JsonPropertyName("website")]
    public string Website { get; set; }
}
```

#### Базовый тест
```csharp
// Tests/BasicGetTests.cs
using NUnit.Framework;
using RestSharp;
using System.Net;

namespace RestSharpGetTests.Tests
{
    [TestFixture]
    public class BasicGetTests
    {
        private RestClient client;
        
        [SetUp]
        public void Setup()
        {
            client = new RestClient("https://jsonplaceholder.typicode.com");
        }
        
        [Test]
        public void GetUser_ValidUserId_ReturnsSuccessStatusCode()
        {
            // Arrange
            var request = new RestRequest("users/1", Method.Get);
            
            // Act
            var response = client.Execute(request);
            
            // Assert
            Assert.That(response.StatusCode, Is.EqualTo(HttpStatusCode.OK));
            Assert.That(response.ContentType, Does.Contain("application/json"));
        }
        
        [Test]
        public void GetUser_ValidUserId_ReturnsCorrectUserData()
        {
            // Arrange
            var request = new RestRequest("users/1", Method.Get);
            
            // Act
            var response = client.Execute<User>(request);
            
            // Assert
            Assert.That(response.Data, Is.Not.Null);
            Assert.That(response.Data.Id, Is.EqualTo(1));
            Assert.That(response.Data.Name, Is.EqualTo("Leanne Graham"));
            Assert.That(response.Data.Username, Is.EqualTo("Bret"));
        }
    }
}
```

### Пример 2: Параметризованные тесты

```csharp
// Tests/DataDrivenGetTests.cs
using NUnit.Framework;
using RestSharp;
using System.Net;

namespace RestSharpGetTests.Tests
{
    [TestFixture]
    public class DataDrivenGetTests
    {
        private RestClient client;
        
        [SetUp]
        public void Setup()
        {
            client = new RestClient("https://jsonplaceholder.typicode.com");
        }
        
        [Test]
        [TestCase(1)]
        [TestCase(2)]
        [TestCase(3)]
        public void GetUser_ValidUserIds_ReturnsSuccessStatusCode(int userId)
        {
            // Arrange
            var request = new RestRequest($"users/{userId}", Method.Get);
            
            // Act
            var response = client.Execute(request);
            
            // Assert
            Assert.That(response.StatusCode, Is.EqualTo(HttpStatusCode.OK));
        }
        
        [Test]
        public void GetUsers_ReturnsListOfUsers()
        {
            // Arrange
            var request = new RestRequest("users", Method.Get);
            
            // Act
            var response = client.Execute<List<User>>(request);
            
            // Assert
            Assert.That(response.Data, Is.Not.Null);
            Assert.That(response.Data, Has.Count.GreaterThan(0));
            Assert.That(response.Data[0].Id, Is.GreaterThan(0));
        }
    }
}
```

### Пример 3: Расширенный клиент с помощником

```csharp
// Helpers/ApiClient.cs
using RestSharp;
using System.Net;

namespace RestSharpGetTests.Helpers
{
    public class ApiClient
    {
        private readonly RestClient _client;
        
        public ApiClient(string baseUrl)
        {
            var options = new RestClientOptions(baseUrl)
            {
                MaxTimeout = 3000,
                ThrowOnAnyError = false
            };
            _client = new RestClient(options);
        }
        
        public RestResponse<T> ExecuteRequest<T>(string endpoint, Method method = Method.Get)
        {
            var request = new RestRequest(endpoint, method);
            return _client.Execute<T>(request);
        }
        
        public RestResponse ExecuteRequest(string endpoint, Method method = Method.Get)
        {
            var request = new RestRequest(endpoint, method);
            return _client.Execute(request);
        }
        
        public void Dispose()
        {
            _client?.Dispose();
        }
    }
}
```

## Ход работы

### Общие шаги для всех вариантов:
1. **Создайте новый проект** типа Class Library в Visual Studio
2. **Установите необходимые NuGet пакеты** (RestSharp, NUnit, etc.)
3. **Создайте структуру папок** согласно шаблону
4. **Реализуйте модели данных** для вашего API
5. **Напишите тестовые классы** с различными типами GET-запросов
6. **Реализуйте параметризованные тесты**
7. **Добавьте обработку ошибок** и граничных случаев
8. **Настройте CI конфигурацию** (опционально)
9. **Создайте README.md** с описанием проекта

## 15 вариантов задания

### Вариант 1: JSONPlaceholder - Users API
**Задание**: Написать автотесты для endpoints:
- GET /users
- GET /users/{id}
- GET /users/{id}/posts
- GET /users/{id}/todos

**Требования**: Проверить статус коды, структуру данных, корректность возвращаемых пользователей.

### Вариант 2: JSONPlaceholder - Posts API
**Задание**: Написать автотесты для endpoints:
- GET /posts
- GET /posts/{id}
- GET /posts/{id}/comments
- GET /users/{userId}/posts

**Требования**: Проверить пагинацию, фильтрацию по пользователю, структуру постов и комментариев.

### Вариант 3: JSONPlaceholder - Comments API
**Задание**: Написать автотесты для endpoints:
- GET /comments
- GET /comments/{id}
- GET /posts/{postId}/comments
- GET /comments?postId={postId}

**Требования**: Проверить разные способы получения комментариев, структуру данных.

### Вариант 4: JSONPlaceholder - Albums and Photos
**Задание**: Написать автотесты для endpoints:
- GET /albums
- GET /albums/{id}
- GET /albums/{id}/photos
- GET /users/{userId}/albums

**Требования**: Проверить связи между альбомами и фотографиями, структуру данных.

### Вариант 5: ReqRes API - User Management
**Задание**: Написать автотесты для endpoints:
- GET /api/users
- GET /api/users/{id}
- GET /api/users?page={page}
- GET /api/users?delay={seconds}

**Требования**: Проверить пагинацию, задержку ответа, структуру пользователей.

### Вариант 6: REST Countries API
**Задание**: Написать автотесты для endpoints:
- GET /v3.1/all
- GET /v3.1/name/{name}
- GET /v3.1/alpha/{code}
- GET /v3.1/region/{region}

**Требования**: Проверить поиск по разным параметрам, валидацию структуры страны.

### Вариант 7: OpenWeatherMap API
**Задание**: Написать автотесты для endpoints:
- GET /data/2.5/weather?q={city}
- GET /data/2.5/weather?lat={lat}&lon={lon}
- GET /data/2.5/forecast?q={city}
- GET /data/2.5/weather?zip={zipcode}

**Требования**: Использовать API key, проверить разные форматы запросов.

### Вариант 8: GitHub API - Repositories
**Задание**: Написать автотесты для endpoints:
- GET /users/{username}/repos
- GET /repos/{owner}/{repo}
- GET /repos/{owner}/{repo}/languages
- GET /search/repositories?q={query}

**Требования**: Использовать токен авторизации, проверить структуру репозиториев.

### Вариант 9: Dog CEO API
**Задание**: Написать автотесты для endpoints:
- GET /breeds/list/all
- GET /breed/{breed}/images
- GET /breeds/image/random
- GET /breeds/image/random/{count}

**Требования**: Проверить получение случайных изображений, список пород.

### Вариант 10: Cat Facts API
**Задание**: Написать автотесты для endpoints:
- GET /facts
- GET /facts?limit={limit}
- GET /facts?max_length={length}
- GET /breeds

**Требования**: Проверить пагинацию, фильтрацию по длине факта.

### Вариант 11: JSONPlaceholder - Todos API
**Задание**: Написать автотесты для endpoints:
- GET /todos
- GET /todos/{id}
- GET /users/{userId}/todos
- GET /todos?completed={true/false}

**Требования**: Проверить фильтрацию по статусу выполнения, структуру задач.

### Вариант 12: Agify API
**Задание**: Написать автотесты для endpoints:
- GET /?name={name}
- GET /?name[]={name1}&name[]={name2}
- GET /?name={name}&country_id={country}
- GET /?name={name}&probability={prob}

**Требования**: Проверить предсказания для одного и нескольких имен.

### Вариант 13: Nationalize API
**Задание**: Написать автотесты для endpoints:
- GET /?name={name}
- GET /?name[]={name1}&name[]={name2}
- GET /?name={name}&country={country}

**Требования**: Проверить определение национальности по имени.

### Вариант 14: Genderize API
**Задание**: Написать автотесты для endpoints:
- GET /?name={name}
- GET /?name[]={name1}&name[]={name2}
- GET /?name={name}&country_id={country}

**Требования**: Проверить определение пола по имени для разных стран.

### Вариант 15: CoinGecko API (Public endpoints)
**Задание**: Написать автотесты для endpoints:
- GET /api/v3/ping
- GET /api/v3/simple/price?ids=bitcoin&vs_currencies=usd
- GET /api/v3/coins/markets?vs_currency=usd
- GET /api/v3/coins/{id}

**Требования**: Проверить статус API, получение цен криптовалют.

## Критерии оценки

### Отлично (9-10 баллов)
- Все тесты реализованы согласно требованиям варианта
- Используется параметризация тестов
- Реализована правильная структура проекта и моделей данных
- Добавлена обработка ошибок и граничных случаев
- Тесты покрывают различные сценарии (позитивные, негативные)
- README.md содержит полное описание с примерами кода

### Хорошо (7-8 баллов)
- Реализованы основные тесты согласно варианту
- Используются базовые assertions
- Проект имеет логическую структуру
- Покрыты основные сценарии работы API
- README.md содержит описание выполнения работы

### Удовлетворительно (5-6 баллов)
- Реализованы базовые тесты
- Проект компилируется и тесты выполняются
- Покрыты минимальные требования варианта
- README.md содержит краткое описание

### Неудовлетворительно (0-4 баллов)
- Тесты не реализованы или не работают
- Проект не компилируется
- README.md отсутствует или неинформативен

## Контрольные вопросы

1. Какие основные компоненты RestSharp используются для работы с API?
2. Как настроить timeout для RestClient?
3. Какие методы HTTP поддерживает RestSharp?
4. Как работать с query parameters в RestRequest?
5. Как десериализовать JSON ответ в собственную модель?
6. Какие способы аутентификации поддерживает RestSharp?
7. Как организовать параметризованные тесты в NUnit?
8. Как обрабатывать ошибки HTTP в RestSharp?
9. Какие преимущества использования моделей данных в тестах?
10. Как организовать переиспользуемый клиент для API?

---

## Пример реализации для варианта 1

### Структура проекта
```
RestSharpGetTests/
│
├── Models/
│   ├── User.cs
│   ├── Post.cs
│   └── Todo.cs
│
├── Tests/
│   └── UserApiTests.cs
│
├── Helpers/
│   └── ApiClient.cs
│
└── README.md
```

### Models/User.cs
```csharp
using System.Text.Json.Serialization;

public class User
{
    [JsonPropertyName("id")]
    public int Id { get; set; }
    
    [JsonPropertyName("name")]
    public string Name { get; set; }
    
    [JsonPropertyName("username")]
    public string Username { get; set; }
    
    [JsonPropertyName("email")]
    public string Email { get; set; }
    
    [JsonPropertyName("address")]
    public Address Address { get; set; }
    
    [JsonPropertyName("phone")]
    public string Phone { get; set; }
    
    [JsonPropertyName("website")]
    public string Website { get; set; }
    
    [JsonPropertyName("company")]
    public Company Company { get; set; }
}

public class Address
{
    [JsonPropertyName("street")]
    public string Street { get; set; }
    
    [JsonPropertyName("suite")]
    public string Suite { get; set; }
    
    [JsonPropertyName("city")]
    public string City { get; set; }
    
    [JsonPropertyName("zipcode")]
    public string Zipcode { get; set; }
    
    [JsonPropertyName("geo")]
    public Geo Geo { get; set; }
}

public class Geo
{
    [JsonPropertyName("lat")]
    public string Lat { get; set; }
    
    [JsonPropertyName("lng")]
    public string Lng { get; set; }
}

public class Company
{
    [JsonPropertyName("name")]
    public string Name { get; set; }
    
    [JsonPropertyName("catchPhrase")]
    public string CatchPhrase { get; set; }
    
    [JsonPropertyName("bs")]
    public string Bs { get; set; }
}
```

### Tests/UserApiTests.cs
```csharp
using NUnit.Framework;
using RestSharp;
using System.Net;

namespace RestSharpGetTests.Tests
{
    [TestFixture]
    public class UserApiTests
    {
        private ApiClient apiClient;
        
        [SetUp]
        public void Setup()
        {
            apiClient = new ApiClient("https://jsonplaceholder.typicode.com");
        }
        
        [Test]
        public void GetAllUsers_ReturnsListOfUsers()
        {
            // Act
            var response = apiClient.ExecuteRequest<List<User>>("users");
            
            // Assert
            Assert.That(response.StatusCode, Is.EqualTo(HttpStatusCode.OK));
            Assert.That(response.Data, Is.Not.Null);
            Assert.That(response.Data, Has.Count.GreaterThan(0));
            
            var firstUser = response.Data[0];
            Assert.That(firstUser.Id, Is.GreaterThan(0));
            Assert.That(firstUser.Name, Is.Not.Null.And.Not.Empty);
            Assert.That(firstUser.Email, Is.Not.Null.And.Not.Empty);
        }
        
        [Test]
        [TestCase(1)]
        [TestCase(2)]
        [TestCase(3)]
        public void GetUserById_ValidId_ReturnsUser(int userId)
        {
            // Act
            var response = apiClient.ExecuteRequest<User>($"users/{userId}");
            
            // Assert
            Assert.That(response.StatusCode, Is.EqualTo(HttpStatusCode.OK));
            Assert.That(response.Data, Is.Not.Null);
            Assert.That(response.Data.Id, Is.EqualTo(userId));
            Assert.That(response.Data.Name, Is.Not.Null.And.Not.Empty);
        }
        
        [Test]
        public void GetUserPosts_ValidUserId_ReturnsPosts()
        {
            // Act
            var response = apiClient.ExecuteRequest<List<Post>>("users/1/posts");
            
            // Assert
            Assert.That(response.StatusCode, Is.EqualTo(HttpStatusCode.OK));
            Assert.That(response.Data, Is.Not.Null);
            Assert.That(response.Data, Has.Count.GreaterThan(0));
            
            var firstPost = response.Data[0];
            Assert.That(firstPost.UserId, Is.EqualTo(1));
            Assert.That(firstPost.Title, Is.Not.Null.And.Not.Empty);
        }
        
        [Test]
        public void GetUserTodos_ValidUserId_ReturnsTodos()
        {
            // Act
            var response = apiClient.ExecuteRequest<List<Todo>>("users/1/todos");
            
            // Assert
            Assert.That(response.StatusCode, Is.EqualTo(HttpStatusCode.OK));
            Assert.That(response.Data, Is.Not.Null);
            Assert.That(response.Data, Has.Count.GreaterThan(0));
            
            var firstTodo = response.Data[0];
            Assert.That(firstTodo.UserId, Is.EqualTo(1));
            Assert.That(firstTodo.Title, Is.Not.Null.And.Not.Empty);
        }
        
        [Test]
        public void GetUser_InvalidUserId_ReturnsNotFound()
        {
            // Act
            var response = apiClient.ExecuteRequest("users/9999");
            
            // Assert
            Assert.That(response.StatusCode, Is.EqualTo(HttpStatusCode.NotFound));
        }
        
        [TearDown]
        public void TearDown()
        {
            apiClient?.Dispose();
        }
    }
}
```

### README.md
```markdown
# Практическая работа 24: Написание автотестов для GET-запросов с использованием RestSharp

## Вариант 1: JSONPlaceholder Users API

### Задание
Написать автотесты для endpoints:
- GET /users
- GET /users/{id}
- GET /users/{id}/posts  
- GET /users/{id}/todos

### Реализация

#### Структура проекта
```
RestSharpGetTests/
├── Models/
│   ├── User.cs
│   ├── Post.cs
│   └── Todo.cs
├── Tests/
│   └── UserApiTests.cs
├── Helpers/
│   └── ApiClient.cs
└── README.md
```

#### Пример теста
```csharp
[Test]
public void GetUserById_ValidId_ReturnsUser()
{
    // Act
    var response = apiClient.ExecuteRequest<User>("users/1");
    
    // Assert
    Assert.That(response.StatusCode, Is.EqualTo(HttpStatusCode.OK));
    Assert.That(response.Data.Id, Is.EqualTo(1));
    Assert.That(response.Data.Name, Is.Not.Null.And.Not.Empty);
}
```

#### Запуск тестов
```bash
dotnet test
```

### Результаты
Все тесты успешно проходят, покрывая основные сценарии работы с Users API.
```

Этот шаблон можно адаптировать для любого из 15 вариантов, изменив модели данных и тестовые методы согласно конкретному API.