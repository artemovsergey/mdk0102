# Самостоятельная работа 2. Разработка полноценного тестового набора для REST API сервиса

Разработка комплексного тестового набора для REST API сервиса с использованием .NET, RestSharp и NUnit

## Цель
Разработать полноценный тестовый набор для реального REST API сервиса, включающий автоматизированные тесты для всех основных операций CRUD, валидацию ответов, обработку ошибок и интеграцию с CI/CD.

## Задачи
- Проанализировать API документацию и определить тестовые сценарии
- Разработать архитектуру тестового проекта
- Реализовать модели данных для запросов и ответов
- Создать тестовые наборы для всех endpoint'ов
- Реализовать параметризованные и data-driven тесты
- Добавить обработку ошибок и негативные тесты
- Настроить конфигурацию и окружения
- Интегрировать с системой CI/CD
- Создать отчетность и документацию

## Выбор тестируемого API

Для данной работы выбран **JSONPlaceholder** - бесплатный fake API для тестирования и прототипирования, который предоставляет следующие ресурсы:
- /posts (100 постов)
- /comments (500 комментариев) 
- /albums (100 альбомов)
- /photos (5000 фотографий)
- /todos (200 задач)
- /users (10 пользователей)

## Архитектура тестового проекта

```
RestApiTestSuite/
│
├── Config/
│   ├── AppSettings.cs
│   └── EnvironmentConfig.cs
│
├── Models/
│   ├── Requests/
│   │   ├── CreatePostRequest.cs
│   │   ├── UpdatePostRequest.cs
│   │   └── CreateUserRequest.cs
│   ├── Responses/
│   │   ├── PostResponse.cs
│   │   ├── UserResponse.cs
│   │   └── ErrorResponse.cs
│   └── Entities/
│       ├── Post.cs
│       ├── User.cs
│       ├── Comment.cs
│       ├── Album.cs
│       └── Todo.cs
│
├── Services/
│   ├── ApiClient.cs
│   ├── PostService.cs
│   ├── UserService.cs
│   ├── CommentService.cs
│   └── IApiService.cs
│
├── Tests/
│   ├── SmokeTests/
│   │   └── ApiSmokeTests.cs
│   ├── FunctionalTests/
│   │   ├── PostTests.cs
│   │   ├── UserTests.cs
│   │   ├── CommentTests.cs
│   │   └── AlbumTests.cs
│   ├── IntegrationTests/
│   │   └── CrossEntityTests.cs
│   ├── NegativeTests/
│   │   └── ErrorHandlingTests.cs
│   └── PerformanceTests/
│       └── ResponseTimeTests.cs
│
├── TestData/
│   ├── TestDataGenerator.cs
│   ├── TestCases/
│   │   ├── PostTestCases.cs
│   │   └── UserTestCases.cs
│   └── Constants/
│       └── ApiConstants.cs
│
├── Utilities/
│   ├── Logger.cs
│   ├── AssertHelper.cs
│   ├── FileHelper.cs
│   └── RetryPolicy.cs
│
├── Reports/
│   └── HtmlReporter.cs
│
├── .github/
│   └── workflows/
│       └── dotnet.yml
│
├── appsettings.json
├── README.md
└── RestApiTestSuite.csproj
```

## Реализация проекта

### 1. Конфигурация проекта

#### RestApiTestSuite.csproj
```xml
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net8.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <IsPackable>false</IsPackable>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.NET.Test.Sdk" Version="17.8.0" />
    <PackageReference Include="NUnit" Version="3.14.0" />
    <PackageReference Include="NUnit3TestAdapter" Version="4.5.0" />
    <PackageReference Include="NUnit.Analyzers" Version="3.9.0" />
    <PackageReference Include="coverlet.collector" Version="6.0.0" />
    <PackageReference Include="RestSharp" Version="110.2.0" />
    <PackageReference Include="Bogus" Version="35.4.0" />
    <PackageReference Include="Microsoft.Extensions.Configuration" Version="8.0.0" />
    <PackageReference Include="Microsoft.Extensions.Configuration.Json" Version="8.0.0" />
    <PackageReference Include="FluentAssertions" Version="6.12.0" />
    <PackageReference Include="Newtonsoft.Json" Version="13.0.3" />
  </ItemGroup>

  <ItemGroup>
    <None Update="appsettings.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>

</Project>
```

#### appsettings.json
```json
{
  "ApiSettings": {
    "BaseUrl": "https://jsonplaceholder.typicode.com",
    "Timeout": 30,
    "MaxRetries": 3
  },
  "TestSettings": {
    "RunSmokeTests": true,
    "RunFunctionalTests": true,
    "RunPerformanceTests": false,
    "SlowTestThreshold": 1000
  },
  "Logging": {
    "LogLevel": "Information",
    "WriteToFile": true,
    "FileLocation": "logs/test.log"
  }
}
```

### 2. Модели данных

#### Модели запросов
```csharp
// Models/Requests/CreatePostRequest.cs
using System.Text.Json.Serialization;

namespace RestApiTestSuite.Models.Requests
{
    public class CreatePostRequest
    {
        [JsonPropertyName("title")]
        public string Title { get; set; }

        [JsonPropertyName("body")]
        public string Body { get; set; }

        [JsonPropertyName("userId")]
        public int UserId { get; set; }

        public CreatePostRequest(string title, string body, int userId)
        {
            Title = title;
            Body = body;
            UserId = userId;
        }
    }

    public class UpdatePostRequest
    {
        [JsonPropertyName("id")]
        public int Id { get; set; }

        [JsonPropertyName("title")]
        public string Title { get; set; }

        [JsonPropertyName("body")]
        public string Body { get; set; }

        [JsonPropertyName("userId")]
        public int UserId { get; set; }
    }

    public class CreateUserRequest
    {
        [JsonPropertyName("name")]
        public string Name { get; set; }

        [JsonPropertyName("username")]
        public string Username { get; set; }

        [JsonPropertyName("email")]
        public string Email { get; set; }

        [JsonPropertyName("address")]
        public AddressRequest Address { get; set; }

        [JsonPropertyName("phone")]
        public string Phone { get; set; }

        [JsonPropertyName("website")]
        public string Website { get; set; }

        [JsonPropertyName("company")]
        public CompanyRequest Company { get; set; }
    }

    public class AddressRequest
    {
        [JsonPropertyName("street")]
        public string Street { get; set; }

        [JsonPropertyName("suite")]
        public string Suite { get; set; }

        [JsonPropertyName("city")]
        public string City { get; set; }

        [JsonPropertyName("zipcode")]
        public string Zipcode { get; set; }

        [JsonPropertyName("geo")]
        public GeoRequest Geo { get; set; }
    }

    public class GeoRequest
    {
        [JsonPropertyName("lat")]
        public string Lat { get; set; }

        [JsonPropertyName("lng")]
        public string Lng { get; set; }
    }

    public class CompanyRequest
    {
        [JsonPropertyName("name")]
        public string Name { get; set; }

        [JsonPropertyName("catchPhrase")]
        public string CatchPhrase { get; set; }

        [JsonPropertyName("bs")]
        public string Bs { get; set; }
    }
}
```

#### Модели ответов
```csharp
// Models/Responses/PostResponse.cs
using System.Text.Json.Serialization;

namespace RestApiTestSuite.Models.Responses
{
    public class PostResponse
    {
        [JsonPropertyName("userId")]
        public int UserId { get; set; }

        [JsonPropertyName("id")]
        public int Id { get; set; }

        [JsonPropertyName("title")]
        public string Title { get; set; }

        [JsonPropertyName("body")]
        public string Body { get; set; }

        public override bool Equals(object obj)
        {
            return obj is PostResponse response &&
                   UserId == response.UserId &&
                   Id == response.Id &&
                   Title == response.Title &&
                   Body == response.Body;
        }

        public override int GetHashCode()
        {
            return HashCode.Combine(UserId, Id, Title, Body);
        }
    }

    public class UserResponse
    {
        [JsonPropertyName("id")]
        public int Id { get; set; }

        [JsonPropertyName("name")]
        public string Name { get; set; }

        [JsonPropertyName("username")]
        public string Username { get; set; }

        [JsonPropertyName("email")]
        public string Email { get; set; }

        [JsonPropertyName("address")]
        public AddressResponse Address { get; set; }

        [JsonPropertyName("phone")]
        public string Phone { get; set; }

        [JsonPropertyName("website")]
        public string Website { get; set; }

        [JsonPropertyName("company")]
        public CompanyResponse Company { get; set; }
    }

    public class AddressResponse
    {
        [JsonPropertyName("street")]
        public string Street { get; set; }

        [JsonPropertyName("suite")]
        public string Suite { get; set; }

        [JsonPropertyName("city")]
        public string City { get; set; }

        [JsonPropertyName("zipcode")]
        public string Zipcode { get; set; }

        [JsonPropertyName("geo")]
        public GeoResponse Geo { get; set; }
    }

    public class GeoResponse
    {
        [JsonPropertyName("lat")]
        public string Lat { get; set; }

        [JsonPropertyName("lng")]
        public string Lng { get; set; }
    }

    public class CompanyResponse
    {
        [JsonPropertyName("name")]
        public string Name { get; set; }

        [JsonPropertyName("catchPhrase")]
        public string CatchPhrase { get; set; }

        [JsonPropertyName("bs")]
        public string Bs { get; set; }
    }

    public class ErrorResponse
    {
        [JsonPropertyName("error")]
        public string Error { get; set; }

        [JsonPropertyName("message")]
        public string Message { get; set; }

        [JsonPropertyName("statusCode")]
        public int StatusCode { get; set; }
    }
}
```

### 3. Сервисы API

#### Базовый клиент
```csharp
// Services/ApiClient.cs
using RestSharp;
using RestApiTestSuite.Config;
using RestApiTestSuite.Utilities;
using System.Net;

namespace RestApiTestSuite.Services
{
    public interface IApiClient
    {
        Task<RestResponse<T>> ExecuteAsync<T>(RestRequest request);
        Task<RestResponse> ExecuteAsync(RestRequest request);
        string BaseUrl { get; }
    }

    public class ApiClient : IApiClient
    {
        private readonly RestClient _client;
        private readonly Logger _logger;

        public string BaseUrl { get; }

        public ApiClient(AppSettings config)
        {
            var options = new RestClientOptions(config.ApiSettings.BaseUrl)
            {
                MaxTimeout = config.ApiSettings.Timeout * 1000,
                ThrowOnAnyError = false
            };

            _client = new RestClient(options);
            _logger = new Logger();
            BaseUrl = config.ApiSettings.BaseUrl;
        }

        public async Task<RestResponse<T>> ExecuteAsync<T>(RestRequest request)
        {
            _logger.Info($"Executing {request.Method} request to: {request.Resource}");

            try
            {
                var response = await _client.ExecuteAsync<T>(request);
                
                _logger.Info($"Response status: {response.StatusCode}");
                _logger.Debug($"Response content: {response.Content}");

                return response;
            }
            catch (Exception ex)
            {
                _logger.Error($"Request failed: {ex.Message}");
                throw;
            }
        }

        public async Task<RestResponse> ExecuteAsync(RestRequest request)
        {
            _logger.Info($"Executing {request.Method} request to: {request.Resource}");

            try
            {
                var response = await _client.ExecuteAsync(request);
                
                _logger.Info($"Response status: {response.StatusCode}");
                _logger.Debug($"Response content: {response.Content}");

                return response;
            }
            catch (Exception ex)
            {
                _logger.Error($"Request failed: {ex.Message}");
                throw;
            }
        }

        public void Dispose()
        {
            _client?.Dispose();
        }
    }
}
```

#### Сервис для работы с постами
```csharp
// Services/PostService.cs
using RestApiTestSuite.Models.Requests;
using RestApiTestSuite.Models.Responses;
using RestSharp;

namespace RestApiTestSuite.Services
{
    public interface IPostService
    {
        Task<RestResponse<List<PostResponse>>> GetAllPostsAsync();
        Task<RestResponse<PostResponse>> GetPostByIdAsync(int id);
        Task<RestResponse<PostResponse>> CreatePostAsync(CreatePostRequest post);
        Task<RestResponse<PostResponse>> UpdatePostAsync(int id, UpdatePostRequest post);
        Task<RestResponse<PostResponse>> PatchPostAsync(int id, object partialUpdate);
        Task<RestResponse> DeletePostAsync(int id);
        Task<RestResponse<List<PostResponse>>> GetPostsByUserIdAsync(int userId);
    }

    public class PostService : IPostService
    {
        private readonly IApiClient _apiClient;

        public PostService(IApiClient apiClient)
        {
            _apiClient = apiClient;
        }

        public async Task<RestResponse<List<PostResponse>>> GetAllPostsAsync()
        {
            var request = new RestRequest("posts", Method.Get);
            return await _apiClient.ExecuteAsync<List<PostResponse>>(request);
        }

        public async Task<RestResponse<PostResponse>> GetPostByIdAsync(int id)
        {
            var request = new RestRequest($"posts/{id}", Method.Get);
            return await _apiClient.ExecuteAsync<PostResponse>(request);
        }

        public async Task<RestResponse<PostResponse>> CreatePostAsync(CreatePostRequest post)
        {
            var request = new RestRequest("posts", Method.Post);
            request.AddJsonBody(post);
            return await _apiClient.ExecuteAsync<PostResponse>(request);
        }

        public async Task<RestResponse<PostResponse>> UpdatePostAsync(int id, UpdatePostRequest post)
        {
            var request = new RestRequest($"posts/{id}", Method.Put);
            request.AddJsonBody(post);
            return await _apiClient.ExecuteAsync<PostResponse>(request);
        }

        public async Task<RestResponse<PostResponse>> PatchPostAsync(int id, object partialUpdate)
        {
            var request = new RestRequest($"posts/{id}", Method.Patch);
            request.AddJsonBody(partialUpdate);
            return await _apiClient.ExecuteAsync<PostResponse>(request);
        }

        public async Task<RestResponse> DeletePostAsync(int id)
        {
            var request = new RestRequest($"posts/{id}", Method.Delete);
            return await _apiClient.ExecuteAsync(request);
        }

        public async Task<RestResponse<List<PostResponse>>> GetPostsByUserIdAsync(int userId)
        {
            var request = new RestRequest("posts", Method.Get);
            request.AddParameter("userId", userId);
            return await _apiClient.ExecuteAsync<List<PostResponse>>(request);
        }
    }
}
```

### 4. Генератор тестовых данных

```csharp
// TestData/TestDataGenerator.cs
using Bogus;
using RestApiTestSuite.Models.Requests;

namespace RestApiTestSuite.TestData
{
    public class TestDataGenerator
    {
        private readonly Faker<CreatePostRequest> _postFaker;
        private readonly Faker<CreateUserRequest> _userFaker;
        private readonly Faker<AddressRequest> _addressFaker;
        private readonly Faker<CompanyRequest> _companyFaker;

        public TestDataGenerator()
        {
            _addressFaker = new Faker<AddressRequest>()
                .RuleFor(a => a.Street, f => f.Address.StreetAddress())
                .RuleFor(a => a.Suite, f => f.Address.SecondaryAddress())
                .RuleFor(a => a.City, f => f.Address.City())
                .RuleFor(a => a.Zipcode, f => f.Address.ZipCode())
                .RuleFor(a => a.Geo, f => new GeoRequest
                {
                    Lat = f.Address.Latitude().ToString("F6"),
                    Lng = f.Address.Longitude().ToString("F6")
                });

            _companyFaker = new Faker<CompanyRequest>()
                .RuleFor(c => c.Name, f => f.Company.CompanyName())
                .RuleFor(c => c.CatchPhrase, f => f.Company.CatchPhrase())
                .RuleFor(c => c.Bs, f => f.Company.Bs());

            _userFaker = new Faker<CreateUserRequest>()
                .RuleFor(u => u.Name, f => f.Person.FullName)
                .RuleFor(u => u.Username, f => f.Internet.UserName())
                .RuleFor(u => u.Email, f => f.Internet.Email())
                .RuleFor(u => u.Phone, f => f.Phone.PhoneNumber())
                .RuleFor(u => u.Website, f => f.Internet.Url())
                .RuleFor(u => u.Address, _ => _addressFaker.Generate())
                .RuleFor(u => u.Company, _ => _companyFaker.Generate());

            _postFaker = new Faker<CreatePostRequest>()
                .RuleFor(p => p.Title, f => f.Lorem.Sentence(5))
                .RuleFor(p => p.Body, f => f.Lorem.Paragraphs(2))
                .RuleFor(p => p.UserId, f => f.Random.Int(1, 10));
        }

        public CreatePostRequest GeneratePost(int? userId = null)
        {
            var post = _postFaker.Generate();
            if (userId.HasValue)
            {
                post.UserId = userId.Value;
            }
            return post;
        }

        public CreateUserRequest GenerateUser()
        {
            return _userFaker.Generate();
        }

        public UpdatePostRequest GenerateUpdatedPost(int postId, int userId)
        {
            var faker = new Faker();
            return new UpdatePostRequest
            {
                Id = postId,
                UserId = userId,
                Title = faker.Lorem.Sentence(6),
                Body = faker.Lorem.Paragraphs(3)
            };
        }

        public object GeneratePartialPostUpdate()
        {
            var faker = new Faker();
            return new
            {
                title = faker.Lorem.Sentence(4),
                body = faker.Lorem.Paragraph()
            };
        }
    }
}
```

### 5. Базовый класс для тестов

```csharp
// Tests/BaseTest.cs
using NUnit.Framework;
using RestApiTestSuite.Config;
using RestApiTestSuite.Services;
using RestApiTestSuite.TestData;
using RestApiTestSuite.Utilities;

namespace RestApiTestSuite.Tests
{
    [TestFixture]
    public abstract class BaseTest
    {
        protected IApiClient ApiClient;
        protected TestDataGenerator TestData;
        protected Logger Logger;
        protected AppSettings Config;

        private PostService _postService;
        private UserService _userService;
        private CommentService _commentService;

        [OneTimeSetUp]
        public void OneTimeSetUp()
        {
            Config = ConfigurationHelper.LoadConfiguration();
            Logger = new Logger();
            TestData = new TestDataGenerator();
        }

        [SetUp]
        public virtual void Setup()
        {
            ApiClient = new ApiClient(Config);
            _postService = new PostService(ApiClient);
            _userService = new UserService(ApiClient);
            _commentService = new CommentService(ApiClient);
        }

        [TearDown]
        public virtual void TearDown()
        {
            (ApiClient as IDisposable)?.Dispose();
        }

        protected IPostService PostService => _postService;
        protected IUserService UserService => _userService;
        protected ICommentService CommentService => _commentService;
    }
}
```

### 6. Функциональные тесты

```csharp
// Tests/FunctionalTests/PostTests.cs
using FluentAssertions;
using NUnit.Framework;
using RestApiTestSuite.Models.Requests;
using RestApiTestSuite.Models.Responses;
using RestSharp;
using System.Net;

namespace RestApiTestSuite.Tests.FunctionalTests
{
    [TestFixture]
    [Category("Functional")]
    [Category("Posts")]
    public class PostTests : BaseTest
    {
        [Test]
        [Description("Получение всех постов должно возвращать статус 200 и непустой список")]
        public async Task GetAllPosts_ShouldReturnOkAndNonEmptyList()
        {
            // Act
            var response = await PostService.GetAllPostsAsync();

            // Assert
            response.StatusCode.Should().Be(HttpStatusCode.OK);
            response.Data.Should().NotBeNull();
            response.Data.Should().NotBeEmpty();
            response.Data.Count.Should().BeGreaterThan(0);
        }

        [Test]
        [Description("Получение существующего поста по ID должно возвращать корректные данные")]
        public async Task GetPostById_WithValidId_ShouldReturnPost()
        {
            // Arrange
            var expectedPostId = 1;

            // Act
            var response = await PostService.GetPostByIdAsync(expectedPostId);

            // Assert
            response.StatusCode.Should().Be(HttpStatusCode.OK);
            response.Data.Should().NotBeNull();
            response.Data.Id.Should().Be(expectedPostId);
            response.Data.Title.Should().NotBeNullOrEmpty();
            response.Data.Body.Should().NotBeNullOrEmpty();
            response.Data.UserId.Should().BeGreaterThan(0);
        }

        [Test]
        [Description("Создание нового поста должно возвращать статус 201 и данные созданного поста")]
        public async Task CreatePost_WithValidData_ShouldReturnCreatedPost()
        {
            // Arrange
            var newPost = TestData.GeneratePost(1);

            // Act
            var response = await PostService.CreatePostAsync(newPost);

            // Assert
            response.StatusCode.Should().Be(HttpStatusCode.Created);
            response.Data.Should().NotBeNull();
            response.Data.Id.Should().BeGreaterThan(0);
            response.Data.Title.Should().Be(newPost.Title);
            response.Data.Body.Should().Be(newPost.Body);
            response.Data.UserId.Should().Be(newPost.UserId);
        }

        [Test]
        [Description("Полное обновление поста должно возвращать обновленные данные")]
        public async Task UpdatePost_WithValidData_ShouldReturnUpdatedPost()
        {
            // Arrange
            var postId = 1;
            var updateData = TestData.GenerateUpdatedPost(postId, 1);

            // Act
            var response = await PostService.UpdatePostAsync(postId, updateData);

            // Assert
            response.StatusCode.Should().Be(HttpStatusCode.OK);
            response.Data.Should().NotBeNull();
            response.Data.Id.Should().Be(postId);
            response.Data.Title.Should().Be(updateData.Title);
            response.Data.Body.Should().Be(updateData.Body);
            response.Data.UserId.Should().Be(updateData.UserId);
        }

        [Test]
        [Description("Частичное обновление поста должно возвращать обновленные данные")]
        public async Task PatchPost_WithPartialData_ShouldReturnUpdatedPost()
        {
            // Arrange
            var postId = 1;
            var partialUpdate = TestData.GeneratePartialPostUpdate();

            // Act
            var response = await PostService.PatchPostAsync(postId, partialUpdate);

            // Assert
            response.StatusCode.Should().Be(HttpStatusCode.OK);
            response.Data.Should().NotBeNull();
            response.Data.Id.Should().Be(postId);
        }

        [Test]
        [Description("Удаление поста должно возвращать статус 200")]
        public async Task DeletePost_WithValidId_ShouldReturnOk()
        {
            // Arrange
            var postId = 1;

            // Act
            var response = await PostService.DeletePostAsync(postId);

            // Assert
            response.StatusCode.Should().Be(HttpStatusCode.OK);
        }

        [Test]
        [Description("Получение постов по userId должно возвращать соответствующие посты")]
        public async Task GetPostsByUserId_WithValidUserId_ShouldReturnUserPosts()
        {
            // Arrange
            var userId = 1;

            // Act
            var response = await PostService.GetPostsByUserIdAsync(userId);

            // Assert
            response.StatusCode.Should().Be(HttpStatusCode.OK);
            response.Data.Should().NotBeNull();
            response.Data.Should().NotBeEmpty();
            response.Data.All(p => p.UserId == userId).Should().BeTrue();
        }

        [Test]
        [Description("Полный цикл CRUD операций для поста должен работать корректно")]
        public async Task PostCRUD_FullCycle_ShouldWorkCorrectly()
        {
            // Create
            var newPost = TestData.GeneratePost(1);
            var createResponse = await PostService.CreatePostAsync(newPost);
            createResponse.StatusCode.Should().Be(HttpStatusCode.Created);
            var createdPostId = createResponse.Data.Id;

            try
            {
                // Read
                var getResponse = await PostService.GetPostByIdAsync(createdPostId);
                getResponse.StatusCode.Should().Be(HttpStatusCode.OK);
                getResponse.Data.Title.Should().Be(newPost.Title);

                // Update
                var updateData = TestData.GenerateUpdatedPost(createdPostId, 1);
                var updateResponse = await PostService.UpdatePostAsync(createdPostId, updateData);
                updateResponse.StatusCode.Should().Be(HttpStatusCode.OK);
                updateResponse.Data.Title.Should().Be(updateData.Title);

                // Partial Update
                var partialUpdate = new { title = "Updated Title" };
                var patchResponse = await PostService.PatchPostAsync(createdPostId, partialUpdate);
                patchResponse.StatusCode.Should().Be(HttpStatusCode.OK);
                patchResponse.Data.Title.Should().Be("Updated Title");
            }
            finally
            {
                // Delete
                var deleteResponse = await PostService.DeletePostAsync(createdPostId);
                deleteResponse.StatusCode.Should().Be(HttpStatusCode.OK);
            }
        }
    }
}
```

### 7. Параметризованные тесты

```csharp
// Tests/FunctionalTests/UserTests.cs
using FluentAssertions;
using NUnit.Framework;
using RestApiTestSuite.Models.Responses;
using RestSharp;
using System.Net;

namespace RestApiTestSuite.Tests.FunctionalTests
{
    [TestFixture]
    [Category("Functional")]
    [Category("Users")]
    public class UserTests : BaseTest
    {
        [Test]
        [Description("Получение пользователя по валидным ID должно возвращать корректные данные")]
        [TestCase(1, "Leanne Graham")]
        [TestCase(2, "Ervin Howell")]
        [TestCase(3, "Clementine Bauch")]
        public async Task GetUserById_WithValidIds_ShouldReturnCorrectUser(int userId, string expectedName)
        {
            // Act
            var response = await UserService.GetUserByIdAsync(userId);

            // Assert
            response.StatusCode.Should().Be(HttpStatusCode.OK);
            response.Data.Should().NotBeNull();
            response.Data.Id.Should().Be(userId);
            response.Data.Name.Should().Be(expectedName);
            response.Data.Email.Should().NotBeNullOrEmpty();
            response.Data.Username.Should().NotBeNullOrEmpty();
        }

        [Test]
        [Description("Получение всех пользователей должно возвращать 10 пользователей")]
        public async Task GetAllUsers_ShouldReturnTenUsers()
        {
            // Act
            var response = await UserService.GetAllUsersAsync();

            // Assert
            response.StatusCode.Should().Be(HttpStatusCode.OK);
            response.Data.Should().NotBeNull();
            response.Data.Should().HaveCount(10);
        }

        [Test]
        [Description("Структура адреса пользователя должна быть корректной")]
        public async Task GetUser_ShouldHaveCorrectAddressStructure()
        {
            // Act
            var response = await UserService.GetUserByIdAsync(1);

            // Assert
            response.Data.Address.Should().NotBeNull();
            response.Data.Address.Street.Should().NotBeNullOrEmpty();
            response.Data.Address.City.Should().NotBeNullOrEmpty();
            response.Data.Address.Zipcode.Should().NotBeNullOrEmpty();
            response.Data.Address.Geo.Should().NotBeNull();
            response.Data.Address.Geo.Lat.Should().NotBeNullOrEmpty();
            response.Data.Address.Geo.Lng.Should().NotBeNullOrEmpty();
        }

        [Test]
        [Description("Структура компании пользователя должна быть корректной")]
        public async Task GetUser_ShouldHaveCorrectCompanyStructure()
        {
            // Act
            var response = await UserService.GetUserByIdAsync(1);

            // Assert
            response.Data.Company.Should().NotBeNull();
            response.Data.Company.Name.Should().NotBeNullOrEmpty();
            response.Data.Company.CatchPhrase.Should().NotBeNullOrEmpty();
            response.Data.Company.Bs.Should().NotBeNullOrEmpty();
        }
    }
}
```

### 8. Негативные тесты

```csharp
// Tests/NegativeTests/ErrorHandlingTests.cs
using FluentAssertions;
using NUnit.Framework;
using RestSharp;
using System.Net;

namespace RestApiTestSuite.Tests.NegativeTests
{
    [TestFixture]
    [Category("Negative")]
    [Category("ErrorHandling")]
    public class ErrorHandlingTests : BaseTest
    {
        [Test]
        [Description("Получение несуществующего поста должно возвращать 404")]
        public async Task GetPostById_WithNonExistentId_ShouldReturnNotFound()
        {
            // Arrange
            var nonExistentId = 9999;

            // Act
            var response = await PostService.GetPostByIdAsync(nonExistentId);

            // Assert
            response.StatusCode.Should().Be(HttpStatusCode.NotFound);
        }

        [Test]
        [Description("Получение поста с некорректным ID должно обрабатываться корректно")]
        [TestCase(0)]
        [TestCase(-1)]
        public async Task GetPostById_WithInvalidId_ShouldHandleCorrectly(int invalidId)
        {
            // Act
            var response = await PostService.GetPostByIdAsync(invalidId);

            // Assert
            response.StatusCode.Should().Be(HttpStatusCode.NotFound);
        }

        [Test]
        [Description("Создание поста с невалидными данными должно обрабатываться корректно")]
        public async Task CreatePost_WithInvalidData_ShouldHandleCorrectly()
        {
            // Arrange
            var invalidPost = new
            {
                title = "", // пустой заголовок
                body = "", // пустое тело
                userId = -1 // невалидный userId
            };

            // Act
            var request = new RestRequest("posts", Method.Post);
            request.AddJsonBody(invalidPost);
            var response = await ApiClient.ExecuteAsync(request);

            // Assert
            // JSONPlaceholder не валидирует данные, но реальный API вернул бы 400
            response.StatusCode.Should().Be(HttpStatusCode.Created);
        }

        [Test]
        [Description("Обновление несуществующего поста должно возвращать 404")]
        public async Task UpdatePost_WithNonExistentId_ShouldReturnNotFound()
        {
            // Arrange
            var nonExistentId = 9999;
            var updateData = TestData.GenerateUpdatedPost(nonExistentId, 1);

            // Act
            var response = await PostService.UpdatePostAsync(nonExistentId, updateData);

            // Assert
            response.StatusCode.Should().Be(HttpStatusCode.NotFound);
        }

        [Test]
        [Description("Удаление несуществующего поста должно возвращать 404")]
        public async Task DeletePost_WithNonExistentId_ShouldReturnNotFound()
        {
            // Arrange
            var nonExistentId = 9999;

            // Act
            var response = await PostService.DeletePostAsync(nonExistentId);

            // Assert
            response.StatusCode.Should().Be(HttpStatusCode.NotFound);
        }
    }
}
```

### 9. Интеграционные тесты

```csharp
// Tests/IntegrationTests/CrossEntityTests.cs
using FluentAssertions;
using NUnit.Framework;
using RestApiTestSuite.Models.Responses;
using RestSharp;
using System.Net;

namespace RestApiTestSuite.Tests.IntegrationTests
{
    [TestFixture]
    [Category("Integration")]
    [Category("CrossEntity")]
    public class CrossEntityTests : BaseTest
    {
        [Test]
        [Description("Посты пользователя должны соответствовать пользователю")]
        public async Task UserPosts_ShouldBelongToCorrectUser()
        {
            // Arrange
            var userId = 1;

            // Act
            var userResponse = await UserService.GetUserByIdAsync(userId);
            var postsResponse = await PostService.GetPostsByUserIdAsync(userId);

            // Assert
            userResponse.StatusCode.Should().Be(HttpStatusCode.OK);
            postsResponse.StatusCode.Should().Be(HttpStatusCode.OK);
            
            postsResponse.Data.Should().NotBeEmpty();
            postsResponse.Data.All(p => p.UserId == userId).Should().BeTrue();
        }

        [Test]
        [Description("Комментарии к посту должны соответствовать посту")]
        public async Task PostComments_ShouldBelongToCorrectPost()
        {
            // Arrange
            var postId = 1;

            // Act
            var postResponse = await PostService.GetPostByIdAsync(postId);
            var commentsResponse = await CommentService.GetCommentsByPostIdAsync(postId);

            // Assert
            postResponse.StatusCode.Should().Be(HttpStatusCode.OK);
            commentsResponse.StatusCode.Should().Be(HttpStatusCode.OK);
            
            commentsResponse.Data.Should().NotBeEmpty();
            commentsResponse.Data.All(c => c.PostId == postId).Should().BeTrue();
        }

        [Test]
        [Description("Альбомы пользователя должны соответствовать пользователю")]
        public async Task UserAlbums_ShouldBelongToCorrectUser()
        {
            // Arrange
            var userId = 1;

            // Act
            var userResponse = await UserService.GetUserByIdAsync(userId);
            var albumsResponse = await UserService.GetUserAlbumsAsync(userId);

            // Assert
            userResponse.StatusCode.Should().Be(HttpStatusCode.OK);
            albumsResponse.StatusCode.Should().Be(HttpStatusCode.OK);
            
            albumsResponse.Data.Should().NotBeEmpty();
            albumsResponse.Data.All(a => a.UserId == userId).Should().BeTrue();
        }

        [Test]
        [Description("Фотографии в альбоме должны соответствовать альбому")]
        public async Task AlbumPhotos_ShouldBelongToCorrectAlbum()
        {
            // Arrange
            var albumId = 1;

            // Act
            var albumResponse = await UserService.GetAlbumByIdAsync(albumId);
            var photosResponse = await UserService.GetAlbumPhotosAsync(albumId);

            // Assert
            albumResponse.StatusCode.Should().Be(HttpStatusCode.OK);
            photosResponse.StatusCode.Should().Be(HttpStatusCode.OK);
            
            photosResponse.Data.Should().NotBeEmpty();
            photosResponse.Data.All(p => p.AlbumId == albumId).Should().BeTrue();
        }
    }
}
```

### 10. Тесты производительности

```csharp
// Tests/PerformanceTests/ResponseTimeTests.cs
using FluentAssertions;
using NUnit.Framework;
using RestSharp;
using System.Diagnostics;

namespace RestApiTestSuite.Tests.PerformanceTests
{
    [TestFixture]
    [Category("Performance")]
    [Category("ResponseTime")]
    public class ResponseTimeTests : BaseTest
    {
        private const int SlowThreshold = 1000; // ms

        [Test]
        [Description("Получение всех постов должно выполняться быстро")]
        public async Task GetAllPosts_ResponseTime_ShouldBeAcceptable()
        {
            // Arrange
            var stopwatch = new Stopwatch();

            // Act
            stopwatch.Start();
            var response = await PostService.GetAllPostsAsync();
            stopwatch.Stop();

            // Assert
            response.StatusCode.Should().Be(System.Net.HttpStatusCode.OK);
            stopwatch.ElapsedMilliseconds.Should().BeLessThan(SlowThreshold,
                $"Response time {stopwatch.ElapsedMilliseconds}ms exceeds threshold {SlowThreshold}ms");
        }

        [Test]
        [Description("Получение поста по ID должно выполняться быстро")]
        public async Task GetPostById_ResponseTime_ShouldBeAcceptable()
        {
            // Arrange
            var stopwatch = new Stopwatch();

            // Act
            stopwatch.Start();
            var response = await PostService.GetPostByIdAsync(1);
            stopwatch.Stop();

            // Assert
            response.StatusCode.Should().Be(System.Net.HttpStatusCode.OK);
            stopwatch.ElapsedMilliseconds.Should().BeLessThan(SlowThreshold);
        }

        [Test]
        [Description("Создание поста должно выполняться быстро")]
        public async Task CreatePost_ResponseTime_ShouldBeAcceptable()
        {
            // Arrange
            var newPost = TestData.GeneratePost(1);
            var stopwatch = new Stopwatch();

            // Act
            stopwatch.Start();
            var response = await PostService.CreatePostAsync(newPost);
            stopwatch.Stop();

            // Assert
            response.StatusCode.Should().Be(System.Net.HttpStatusCode.Created);
            stopwatch.ElapsedMilliseconds.Should().BeLessThan(SlowThreshold);
        }
    }
}
```

### 11. Утилиты и хелперы

```csharp
// Utilities/Logger.cs
namespace RestApiTestSuite.Utilities
{
    public enum LogLevel
    {
        Debug,
        Info,
        Warning,
        Error
    }

    public class Logger
    {
        private readonly string _logFile;

        public Logger()
        {
            _logFile = Path.Combine(Directory.GetCurrentDirectory(), "test.log");
        }

        public void Log(LogLevel level, string message)
        {
            var logMessage = $"{DateTime.Now:yyyy-MM-dd HH:mm:ss} [{level}] {message}";
            Console.WriteLine(logMessage);

            if (Environment.GetEnvironmentVariable("WRITE_LOG_TO_FILE") == "true")
            {
                File.AppendAllText(_logFile, logMessage + Environment.NewLine);
            }
        }

        public void Debug(string message) => Log(LogLevel.Debug, message);
        public void Info(string message) => Log(LogLevel.Info, message);
        public void Warning(string message) => Log(LogLevel.Warning, message);
        public void Error(string message) => Log(LogLevel.Error, message);
    }
}

// Utilities/AssertHelper.cs
using FluentAssertions;
using RestSharp;

namespace RestApiTestSuite.Utilities
{
    public static class AssertHelper
    {
        public static void ShouldBeSuccessful(this RestResponse response)
        {
            response.IsSuccessful.Should().BeTrue(
                $"Request failed with status {response.StatusCode} and content: {response.Content}");
        }

        public static void ShouldHaveStatusCode(this RestResponse response, System.Net.HttpStatusCode expectedStatusCode)
        {
            response.StatusCode.Should().Be(expectedStatusCode,
                $"Expected status code {expectedStatusCode} but got {response.StatusCode}. Content: {response.Content}");
        }

        public static void ShouldHaveContentType(this RestResponse response, string expectedContentType)
        {
            response.ContentType.Should().Contain(expectedContentType,
                $"Expected content type containing '{expectedContentType}' but got '{response.ContentType}'");
        }
    }
}
```

### 12. Конфигурация CI/CD

```yaml
# .github/workflows/dotnet.yml
name: .NET API Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 8.0.x
        
    - name: Restore dependencies
      run: dotnet restore
      
    - name: Build
      run: dotnet build --no-restore --configuration Release
      
    - name: Run tests
      run: dotnet test --no-build --verbosity normal --configuration Release --logger "trx;LogFileName=test-results.trx"
      
    - name: Upload test results
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: test-results
        path: **/*test-results.trx
        retention-days: 30
```

### 13. README.md

```markdown
# Rest API Test Suite

Полноценный тестовый набор для REST API сервиса JSONPlaceholder.

## Структура проекта

- **Config/** - конфигурационные классы
- **Models/** - модели запросов и ответов
- **Services/** - сервисы для работы с API
- **Tests/** - тестовые классы
- **TestData/** - генераторы тестовых данных
- **Utilities/** - вспомогательные утилиты

## Запуск тестов

### Локальный запуск
```bash
dotnet test
```

### Запуск с категориями
```bash
dotnet test --filter Category=Functional
dotnet test --filter Category=Smoke
dotnet test --filter Category=Performance
```

### Запуск конкретного теста
```bash
dotnet test --filter Name~GetPostById
```

## Категории тестов

- **Smoke** - базовые smoke-тесты
- **Functional** - функциональные тесты
- **Integration** - интеграционные тесты
- **Negative** - негативные тесты
- **Performance** - тесты производительности

## Конфигурация

Настройки указываются в файле `appsettings.json`:

```json
{
  "ApiSettings": {
    "BaseUrl": "https://jsonplaceholder.typicode.com",
    "Timeout": 30
  }
}
```

## Отчетность

Результаты тестов сохраняются в формате TRX и могут быть просмотрены в Visual Studio.
```

## Критерии оценки

### Отлично (9-10 баллов)
- Реализована полная архитектура тестового проекта
- Покрыты все основные endpoint'ы API
- Реализованы различные типы тестов (smoke, functional, integration, negative, performance)
- Используются параметризованные и data-driven тесты
- Добавлена обработка ошибок и валидация
- Настроена CI/CD интеграция
- Создана полная документация
- Код хорошо структурирован и следует best practices

### Хорошо (7-8 баллов)
- Реализованы основные функциональные тесты
- Покрыты основные сценарии работы API
- Добавлены негативные тесты
- Проект имеет логическую структуру
- Написана базовая документация

### Удовлетворительно (5-6 баллов)
- Реализованы базовые тесты для основных операций
- Проект компилируется и тесты выполняются
- Создана минимальная документация

### Неудовлетворительно (0-4 баллов)
- Тесты не реализованы или не работают
- Проект не компилируется
- Документация отсутствует