# Практическая работа 23. Анализ API с помощью Postman

Анализ REST API с использованием Postman: ручное тестирование и автоматизация

## Цель
Освоить практические навыки тестирования REST API с помощью Postman, включая создание коллекций, написание тестовых сценариев и автоматизацию проверок.

## Задачи
- Изучить основные принципы работы с REST API
- Освоить интерфейс Postman и его основные функции
- Научиться создавать и организовывать коллекции запросов
- Освоить написание тестов на JavaScript в Postman
- Научиться работать с переменными и окружениями
- Освоить создание и выполнение коллекций с тестами

## Теоретическая часть

### 1. Основы REST API
REST (Representational State Transfer) - архитектурный стиль для распределенных систем. Основные принципы:
- **HTTP методы**: GET, POST, PUT, DELETE, PATCH
- **Статус коды**: 200 (OK), 201 (Created), 400 (Bad Request), 404 (Not Found), 500 (Server Error)
- **Формат данных**: JSON, XML

### 2. Postman - основные возможности
- Создание и организация HTTP запросов
- Автоматизация тестирования с помощью скриптов
- Работа с переменными и окружениями
- Генерация документации
- Мониторинг API

### 3. Структура тестов в Postman
```javascript
// Пример теста в Postman
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("Response time is less than 200ms", function () {
    pm.expect(pm.response.responseTime).to.be.below(200);
});
```

## Практический пример выполнения

### Задание: Протестировать API JSONPlaceholder

#### Шаг 1: Создание коллекции
1. Откройте Postman
2. Создайте новую коллекцию "JSONPlaceholder Tests"
3. Добавьте описание коллекции

#### Шаг 2: Создание запроса GET /posts
```javascript
// Request: GET https://jsonplaceholder.typicode.com/posts

// Tests:
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("Response has correct structure", function () {
    var jsonData = pm.response.json();
    pm.expect(jsonData).to.be.an('array');
    pm.expect(jsonData[0]).to.have.keys(['userId', 'id', 'title', 'body']);
});

pm.test("Response time is acceptable", function () {
    pm.expect(pm.response.responseTime).to.be.below(500);
});
```

#### Шаг 3: Создание запроса POST /posts
```javascript
// Request: POST https://jsonplaceholder.typicode.com/posts
// Body (raw JSON):
{
    "title": "Test Post",
    "body": "This is a test post",
    "userId": 1
}

// Tests:
pm.test("Status code is 201", function () {
    pm.response.to.have.status(201);
});

pm.test("Response contains posted data", function () {
    var jsonData = pm.response.json();
    pm.expect(jsonData.title).to.eql("Test Post");
    pm.expect(jsonData.body).to.eql("This is a test post");
    pm.expect(jsonData.userId).to.eql(1);
});
```

## Ход работы

### Общие шаги для всех вариантов:
1. **Создайте новую коллекцию** в Postman с названием согласно вашему варианту
2. **Настройте переменные** коллекции (baseUrl)
3. **Создайте запросы** согласно заданию вашего варианта
4. **Напишите тесты** для каждого запроса
5. **Создайте окружение** с переменными
6. **Запустите коллекцию** и убедитесь, что все тесты проходят
7. **Экспортируйте коллекцию** и окружение в файлы
8. **Создайте README.md** с описанием выполнения

## 15 вариантов задания

### Вариант 1: JSONPlaceholder - Posts API
**Задание**: Протестировать endpoints для работы с постами:
- GET /posts
- GET /posts/1
- POST /posts
- PUT /posts/1
- DELETE /posts/1

**Требования**: Проверить статус коды, структуру ответа, время ответа, создание и удаление постов.

### Вариант 2: JSONPlaceholder - Comments API
**Задание**: Протестировать endpoints для работы с комментариями:
- GET /comments
- GET /comments?postId=1
- POST /comments
- GET /posts/1/comments

**Требования**: Проверить фильтрацию, пагинацию, создание комментариев.

### Вариант 3: JSONPlaceholder - Albums and Photos
**Задание**: Протестировать endpoints для альбомов и фотографий:
- GET /albums
- GET /albums/1/photos
- POST /albums
- GET /photos/1

**Требования**: Проверить связи между сущностями, загрузку данных.

### Вариант 4: JSONPlaceholder - Users API
**Задание**: Протестировать endpoints для работы с пользователями:
- GET /users
- GET /users/1
- GET /users/1/posts
- GET /users/1/albums

**Требования**: Проверить получение связанных данных, структуру пользователя.

### Вариант 5: ReqRes API - User Management
**Задание**: Протестировать API управления пользователями:
- GET /api/users?page=2
- GET /api/users/2
- POST /api/users
- PUT /api/users/2

**Требования**: Проверить пагинацию, создание и обновление пользователей.

### Вариант 6: ReqRes API - Authentication
**Задание**: Протестировать систему аутентификации:
- POST /api/register
- POST /api/login
- GET /api/users/2 (без авторизации)
- Добавить токен авторизации

**Требования**: Проверить успешную и неуспешную регистрацию/логин.

### Вариант 7: RESTful Booker API
**Задание**: Протестировать API бронирования:
- GET /booking
- GET /booking/1
- POST /booking
- PUT /booking/1
- DELETE /booking/1

**Требования**: Проверить создание, обновление, отмену бронирований.

### Вариант 8: GitHub API - Repositories
**Задание**: Протестировать API для работы с репозиториями:
- GET /user/repos
- GET /repos/octocat/Hello-World
- POST /user/repos
- DELETE /repos/username/reponame

**Требования**: Использовать Personal Access Token, проверить CRUD операции.

### Вариант 9: OpenWeatherMap API
**Задание**: Протестировать API погоды:
- GET /weather?q=London
- GET /forecast?q=London
- GET /weather?lat=35&lon=139

**Требования**: Проверить разные форматы запросов, обработку ошибок.

### Вариант 10: Currency Exchange API
**Задание**: Протестировать API курсов валют:
- GET /latest?base=USD
- GET /history?start_at=2023-01-01&end_at=2023-01-31
- GET /convert?from=EUR&to=USD&amount=100

**Требования**: Проверить конвертацию, исторические данные.

### Вариант 11: JSONPlaceholder - Todos API
**Задание**: Протестировать API задач:
- GET /todos
- GET /todos/1
- GET /users/1/todos
- POST /todos
- PATCH /todos/1

**Требования**: Проверить обновление задач, фильтрацию по пользователю.

### Вариант 12: REST Countries API
**Задание**: Протестировать API стран:
- GET /all
- GET /name/united
- GET /capital/london
- GET /region/europe

**Требования**: Проверить поиск по разным параметрам, структуру ответа.

### Вариант 13: Dog CEO API
**Задание**: Протестировать API случайных изображений собак:
- GET /breeds/list/all
- GET /breed/hound/images
- GET /breed/hound/list
- GET /breeds/image/random

**Требования**: Проверить получение списка пород, случайных изображений.

### Вариант 14: Cat Facts API
**Задание**: Протестировать API фактов о кошках:
- GET /facts
- GET /facts?limit=5
- GET /facts?max_length=100
- GET /breeds

**Требования**: Проверить пагинацию, фильтрацию по длине факта.

### Вариант 15: Agify API (Prediction by Name)
**Задание**: Протестировать API предсказания возраста по имени:
- GET ?name=michael
- GET ?name=michael&country_id=US
- GET ?name[]=michael&name[]=matthew
- GET ?name=michael&probability=0.95

**Требования**: Проверить предсказания для одного и нескольких имен, разные параметры.

## Критерии оценки

### Отлично (9-10 баллов)
- Все запросы реализованы корректно
- Написаны комплексные тесты для каждого endpoint
- Используются переменные окружения
- Реализованы pre-request scripts где необходимо
- Все тесты проходят успешно
- README.md содержит полное описание с скриншотами

### Хорошо (7-8 баллов)
- Большинство запросов реализовано корректно
- Написаны основные тесты
- Используются базовые переменные
- Большинство тестов проходят
- README.md содержит описание выполнения

### Удовлетворительно (5-6 баллов)
- Реализованы базовые запросы
- Написаны минимальные тесты
- Есть основные проверки
- README.md содержит краткое описание

### Неудовлетворительно (0-4 баллов)
- Запросы реализованы с ошибками
- Тесты отсутствуют или не работают
- README.md отсутствует или неинформативен

## Контрольные вопросы

1. Какие HTTP методы используются в REST API и для каких операций?
2. Как организовать хранение переменных в Postman?
3. Какие виды тестов можно писать в Postman?
4. Как работать с авторизацией в API запросах?
5. Что такое pre-request script и для чего он используется?
6. Как организовать запуск нескольких запросов последовательно?
7. Какие способы параметризации запросов существуют в Postman?
8. Как протестировать производительность API с помощью Postman?
9. Какие возможности предоставляет Postman для документирования API?
10. Как экспортировать и импортировать коллекции в Postman?

---

# Пример структуры репозитория для варианта 1

```
postman-api-testing/
│
├── images/
│   ├── collection-structure.png
│   ├── test-results.png
│   └── environment-variables.png
│
├── collections/
│   └── jsonplaceholder-posts-collection.json
│
├── environments/
│   └── jsonplaceholder-environment.json
│
├── .gitignore
└── README.md
```

## Пример README.md для варианта 1

```markdown
# Практическая работа: Анализ API с помощью Postman

## Вариант 1: JSONPlaceholder - Posts API

### Задание
Протестировать endpoints для работы с постами:
- GET /posts
- GET /posts/1  
- POST /posts
- PUT /posts/1
- DELETE /posts/1

### Решение

#### 1. Структура коллекции
![Структура коллекции](images/collection-structure.png)

#### 2. Переменные окружения
```json
{
  "id": "jsonplaceholder-env",
  "name": "JSONPlaceholder Environment",
  "values": [
    {
      "key": "baseUrl",
      "value": "https://jsonplaceholder.typicode.com",
      "type": "default"
    }
  ]
}
```

#### 3. Пример запроса GET /posts
**Endpoint**: `{{baseUrl}}/posts`

**Tests**:
```javascript
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("Response has posts array", function () {
    var jsonData = pm.response.json();
    pm.expect(jsonData).to.be.an('array');
    pm.expect(jsonData.length).to.be.above(0);
});

pm.test("Each post has required fields", function () {
    var jsonData = pm.response.json();
    jsonData.forEach(function(post) {
        pm.expect(post).to.have.keys(['userId', 'id', 'title', 'body']);
    });
});
```

#### 4. Пример запроса POST /posts
**Endpoint**: `{{baseUrl}}/posts`

**Body**:
```json
{
    "title": "Test Post",
    "body": "This is a test post content",
    "userId": 1
}
```

**Tests**:
```javascript
pm.test("Status code is 201", function () {
    pm.response.to.have.status(201);
});

pm.test("Response contains new post data", function () {
    var jsonData = pm.response.json();
    pm.expect(jsonData.title).to.eql("Test Post");
    pm.expect(jsonData.body).to.eql("This is a test post content");
    pm.expect(jsonData.userId).to.eql(1);
    pm.expect(jsonData.id).to.be.a('number');
});
```

#### 5. Результаты выполнения
![Результаты тестов](images/test-results.png)

Все тесты успешно пройдены. Коллекция содержит 5 запросов с комплексными проверками статус кодов, структуры ответа и бизнес-логики.
```

Этот пример можно адаптировать под любой из 15 вариантов, изменяя endpoints, тесты и описание согласно конкретному заданию.