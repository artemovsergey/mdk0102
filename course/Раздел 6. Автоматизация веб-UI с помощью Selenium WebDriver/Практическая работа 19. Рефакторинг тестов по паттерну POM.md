# Практическая работа 19. Рефакторинг тестов по паттерну Page Object Model (POM)

## Цель работы

* Научиться структурировать автоматизированные тесты с помощью **паттерна Page Object Model (POM)**.
* Рефакторить существующие тесты для повышения читаемости, поддержки и повторного использования.
* Разделять логику страницы и тестовую логику, используя отдельные классы Page Object.

---

## Теоретическая часть

### Что такое POM

**Page Object Model (POM)** — это паттерн проектирования, который предполагает:

1. Создание **класса страницы** (Page Object) для каждой веб-страницы или компонента.

2. В Page классе размещаются:

   * Локаторы элементов
   * Методы для взаимодействия с элементами
   * Методы для получения информации с страницы

3. Тесты используют только методы Page Object, а не напрямую WebDriver.

**Преимущества:**

* Уменьшение дублирования кода
* Простота поддержки тестов при изменении UI
* Читаемость и структурированность
* Возможность переиспользования методов

---

### Структура проекта с POM

```
Project/
│
├─ Drivers/           # Инициализация WebDriver
├─ Pages/             # Page классы (LoginPage.cs, DashboardPage.cs)
├─ Tests/             # Тестовые классы (LoginTests.cs)
├─ images/            # Скриншоты работы тестов
└─ readme.md
```

---

## Ход работы

### Шаг 1. Создание Page Object класса

**Пример: LoginPage.cs**

```csharp
using OpenQA.Selenium;

namespace POMTests.Pages
{
    public class LoginPage
    {
        private readonly IWebDriver _driver;

        public LoginPage(IWebDriver driver)
        {
            _driver = driver;
        }

        // Локаторы
        private IWebElement UsernameField => _driver.FindElement(By.Id("username"));
        private IWebElement PasswordField => _driver.FindElement(By.Id("password"));
        private IWebElement LoginButton => _driver.FindElement(By.Id("loginBtn"));
        private IWebElement ErrorMessage => _driver.FindElement(By.Id("errorMsg"));

        // Методы
        public void EnterUsername(string username) => UsernameField.SendKeys(username);
        public void EnterPassword(string password) => PasswordField.SendKeys(password);
        public void ClickLogin() => LoginButton.Click();
        public string GetErrorMessage() => ErrorMessage.Text;
    }
}
```

---

### Шаг 2. Рефакторинг теста с использованием POM

**LoginTests.cs**

```csharp
using OpenQA.Selenium;
using OpenQA.Selenium.Chrome;
using POMTests.Pages;
using Xunit;

namespace POMTests.Tests
{
    public class LoginTests : IDisposable
    {
        private IWebDriver _driver;
        private LoginPage _loginPage;

        public LoginTests()
        {
            _driver = new ChromeDriver();
            _driver.Manage().Window.Maximize();
            _driver.Navigate().GoToUrl("https://example.com/login");
            _loginPage = new LoginPage(_driver);
        }

        [Fact]
        public void InvalidLoginShowsError()
        {
            _loginPage.EnterUsername("wrongUser");
            _loginPage.EnterPassword("wrongPass");
            _loginPage.ClickLogin();

            string error = _loginPage.GetErrorMessage();
            Assert.Equal("Invalid username or password", error);
        }

        [Fact]
        public void ValidLoginRedirectsToDashboard()
        {
            _loginPage.EnterUsername("admin");
            _loginPage.EnterPassword("admin123");
            _loginPage.ClickLogin();

            Assert.Contains("dashboard", _driver.Url);
        }

        public void Dispose()
        {
            _driver.Quit();
        }
    }
}
```

---

### Шаг 3. Преимущества рефакторинга

* Тесты читаются как сценарии: **"ввести логин → ввести пароль → нажать кнопку → проверить результат"**
* При изменении локаторов достаточно исправить Page класс, тесты остаются без изменений
* Методы Page Object можно переиспользовать в разных тестах

---

## Варианты заданий (по номеру в журнале)

1. Создать Page Object класс для страницы входа
2. Рефакторить существующий тест входа с использованием POM
3. Создать методы для ввода логина и пароля
4. Создать метод для клика по кнопке Login
5. Создать метод для получения текста ошибки
6. Создать тест на некорректный логин
7. Создать тест на корректный логин
8. Создать Page Object для Dashboard страницы
9. Добавить метод проверки отображения элементов Dashboard
10. Создать тест для перехода между страницами через POM
11. Использовать POM для обработки алертов на странице
12. Использовать POM для работы с iframe
13. Создать метод в Page Object для заполнения формы
14. Создать тест с использованием нескольких Page Object классов
15. Полный рефакторинг всех тестов проекта с использованием POM

---

## Критерии оценки

| Оценка | Критерии                                                                                                                      |
| ------ | ----------------------------------------------------------------------------------------------------------------------------- |
| 2      | Тесты работают, но Page Object не используется                                                                                |
| 3      | Создан один Page Object, тесты используют его для части действий                                                              |
| 4      | Несколько Page Object классов, тесты структурированы, работают стабильно                                                      |
| 5      | Полный рефакторинг тестов, используются методы POM для всех действий, есть Page Object для каждой страницы, скриншоты, readme |

---

## Контрольные вопросы

1. Что такое Page Object Model (POM)?
2. Какие преимущества использования POM?
3. Какие элементы и методы включают Page Object классы?
4. Как рефакторинг тестов с POM упрощает поддержку?
5. Как тесты используют методы Page Object?
6. Можно ли использовать один Page Object для нескольких тестов?
7. Как изменять локаторы в POM при обновлении UI?

---

## Структура репозитория

```
POMTests/
│
├─ Drivers/           # Инициализация WebDriver
├─ Pages/             # Page классы (LoginPage.cs, DashboardPage.cs)
├─ Tests/             # Тестовые классы (LoginTests.cs)
├─ images/            # Скриншоты работы тестов
└─ readme.md          # Описание работы, вариант, текст задания
```

### Пример `readme.md`

````markdown
# Практическая работа №19
## Тема: Рефакторинг тестов по паттерну POM
### Вариант: 4

**Задание:** Создать Page Object класс для страницы входа и рефакторить существующие тесты, используя методы Page Object.

**Пример кода (LoginPage.cs):**
```csharp
private IWebElement UsernameField => _driver.FindElement(By.Id("username"));
public void EnterUsername(string username) => UsernameField.SendKeys(username);
````

```