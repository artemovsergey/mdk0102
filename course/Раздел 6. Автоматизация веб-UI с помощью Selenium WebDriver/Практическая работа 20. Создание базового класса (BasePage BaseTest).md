# Практическая работа 20. Создание базового класса (BasePage и BaseTest)

## Цель работы

* Научиться создавать базовые классы для тестовой автоматизации на Selenium WebDriver.
* Освоить концепцию **BasePage** и **BaseTest** для повторного использования кода.
* Снизить дублирование кода и упростить поддержку тестов.

---

## Теоретическая часть

### BasePage

**BasePage** — базовый класс для всех Page Object классов.

**Задачи BasePage:**

* Хранение ссылки на WebDriver
* Содержит общие методы для работы со страницей, например:

  * `WaitForElementVisible()`
  * `Click()`
  * `EnterText()`
  * `GetText()`
* Позволяет наследовать эти методы в конкретных страницах (LoginPage, DashboardPage и др.)

**Пример методов BasePage:**

```csharp
public class BasePage
{
    protected IWebDriver Driver;

    public BasePage(IWebDriver driver)
    {
        Driver = driver;
    }

    public void Click(By locator) => Driver.FindElement(locator).Click();
    public void EnterText(By locator, string text) => Driver.FindElement(locator).SendKeys(text);
    public string GetText(By locator) => Driver.FindElement(locator).Text;
}
```

---

### BaseTest

**BaseTest** — базовый класс для тестов.

**Задачи BaseTest:**

* Инициализация и закрытие WebDriver
* Настройка времени ожидания, размера окна, URL
* Позволяет наследовать тестовые классы, чтобы не дублировать код в каждом тесте

**Пример:**

```csharp
public class BaseTest : IDisposable
{
    protected IWebDriver Driver;

    public BaseTest()
    {
        Driver = new ChromeDriver();
        Driver.Manage().Window.Maximize();
        Driver.Manage().Timeouts().ImplicitWait = TimeSpan.FromSeconds(10);
    }

    public void Dispose()
    {
        Driver.Quit();
    }
}
```

---

## Ход работы

### Шаг 1. Создание BasePage

```csharp
using OpenQA.Selenium;

namespace BaseClasses.Pages
{
    public class BasePage
    {
        protected IWebDriver Driver;

        public BasePage(IWebDriver driver)
        {
            Driver = driver;
        }

        public void Click(By locator) => Driver.FindElement(locator).Click();
        public void EnterText(By locator, string text) => Driver.FindElement(locator).SendKeys(text);
        public string GetText(By locator) => Driver.FindElement(locator).Text;
        public bool IsDisplayed(By locator) => Driver.FindElement(locator).Displayed;
    }
}
```

---

### Шаг 2. Создание конкретного Page Object с наследованием BasePage

**LoginPage.cs**

```csharp
using OpenQA.Selenium;

namespace BaseClasses.Pages
{
    public class LoginPage : BasePage
    {
        private By UsernameField => By.Id("username");
        private By PasswordField => By.Id("password");
        private By LoginButton => By.Id("loginBtn");
        private By ErrorMessage => By.Id("errorMsg");

        public LoginPage(IWebDriver driver) : base(driver) { }

        public void EnterUsername(string username) => EnterText(UsernameField, username);
        public void EnterPassword(string password) => EnterText(PasswordField, password);
        public void ClickLogin() => Click(LoginButton);
        public string GetErrorMessage() => GetText(ErrorMessage);
    }
}
```

---

### Шаг 3. Создание BaseTest

```csharp
using OpenQA.Selenium;
using OpenQA.Selenium.Chrome;
using System;
using Xunit;

namespace BaseClasses.Tests
{
    public class BaseTest : IDisposable
    {
        protected IWebDriver Driver;

        public BaseTest()
        {
            Driver = new ChromeDriver();
            Driver.Manage().Window.Maximize();
            Driver.Manage().Timeouts().ImplicitWait = TimeSpan.FromSeconds(10);
        }

        public void Dispose()
        {
            Driver.Quit();
        }
    }
}
```

---

### Шаг 4. Использование BasePage и BaseTest в тестах

```csharp
using BaseClasses.Pages;
using Xunit;

namespace BaseClasses.Tests
{
    public class LoginTests : BaseTest
    {
        [Fact]
        public void InvalidLoginShowsError()
        {
            Driver.Navigate().GoToUrl("https://example.com/login");

            var loginPage = new LoginPage(Driver);
            loginPage.EnterUsername("wrongUser");
            loginPage.EnterPassword("wrongPass");
            loginPage.ClickLogin();

            string error = loginPage.GetErrorMessage();
            Assert.Equal("Invalid username or password", error);
        }

        [Fact]
        public void ValidLoginRedirectsToDashboard()
        {
            Driver.Navigate().GoToUrl("https://example.com/login");

            var loginPage = new LoginPage(Driver);
            loginPage.EnterUsername("admin");
            loginPage.EnterPassword("admin123");
            loginPage.ClickLogin();

            Assert.Contains("dashboard", Driver.Url);
        }
    }
}
```

---

## Практический пример

**Сценарий:**

1. Создать BasePage и BaseTest.
2. Создать LoginPage с наследованием BasePage.
3. Создать тест LoginTests с наследованием BaseTest.
4. Реализовать проверку некорректного и корректного входа.
5. Все действия выполняются через методы BasePage и LoginPage.

---

## Варианты заданий (по номеру в журнале)

1. Создать BasePage с методами Click, EnterText, GetText
2. Создать BaseTest с инициализацией и закрытием WebDriver
3. Создать LoginPage с наследованием BasePage
4. Реализовать методы LoginPage: EnterUsername, EnterPassword, ClickLogin
5. Создать метод для получения текста ошибки
6. Создать тест InvalidLoginShowsError с использованием BaseTest и LoginPage
7. Создать тест ValidLoginRedirectsToDashboard
8. Создать DashboardPage с наследованием BasePage
9. Реализовать метод проверки отображения элементов Dashboard
10. Создать тест перехода на Dashboard после успешного входа
11. Создать методы для работы с формами на страницах
12. Использовать BasePage для работы с алертами
13. Использовать BasePage для работы с iframe
14. Комбинированный тест: Login → Dashboard → Проверка элементов
15. Полный рефакторинг всех тестов проекта с использованием BasePage и BaseTest

---

## Критерии оценки

| Оценка | Критерии                                                                                                                          |
| ------ | --------------------------------------------------------------------------------------------------------------------------------- |
| 2      | Тесты работают без использования BasePage и BaseTest                                                                              |
| 3      | Создан BasePage или BaseTest, тесты используют один из них                                                                        |
| 4      | Созданы BasePage и BaseTest, тесты структурированы, работают стабильно                                                            |
| 5      | Полный рефакторинг тестов с BasePage и BaseTest, методы переиспользуются, есть Page Object для каждой страницы, скриншоты, readme |

---

## Контрольные вопросы

1. Для чего нужен базовый класс BasePage?
2. Какие методы обычно содержатся в BasePage?
3. Для чего нужен BaseTest?
4. Как наследование BaseTest упрощает создание новых тестов?
5. Как использовать методы BasePage в конкретных Page Object классах?
6. Какие преимущества дает использование BasePage и BaseTest для поддержки тестов?
7. Как рефакторинг тестов через BasePage и BaseTest влияет на читаемость и поддержку кода?

---

## Структура репозитория

```
BaseClasses/
│
├─ Drivers/           # Инициализация WebDriver
├─ Pages/             # Page классы (BasePage.cs, LoginPage.cs, DashboardPage.cs)
├─ Tests/             # Тестовые классы (BaseTest.cs, LoginTests.cs)
├─ images/            # Скриншоты работы тестов
└─ readme.md          # Описание работы, вариант, текст задания
```

### Пример `readme.md`

````markdown
# Практическая работа №20
## Тема: Создание базового класса (BasePage и BaseTest)
### Вариант: 4

**Задание:** Создать BasePage и BaseTest, реализовать LoginPage и тесты на некорректный и корректный вход, используя методы BasePage и BaseTest.

**Пример кода (BasePage.cs):**
```csharp
public void Click(By locator) => Driver.FindElement(locator).Click();
public void EnterText(By locator, string text) => Driver.FindElement(locator).SendKeys(text);
````

```